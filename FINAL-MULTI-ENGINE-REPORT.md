# MotionExpert Backend - å¤š Engine RAG ç³»çµ±æœ€çµ‚å ±å‘Š

## ğŸ¯ é …ç›®å®Œæˆç‹€æ…‹

**ç¸½é«”ç‹€æ…‹ï¼šâœ… åŸºæœ¬å®Œæˆï¼Œå¤š Engine æ¶æ§‹æˆåŠŸå¯¦ç¾**

MotionExpert Backend å·²æˆåŠŸå¾ã€Œä¸€ç”¨æˆ¶ä¸€ Engineã€å‡ç´šç‚ºã€Œä¸€ç”¨æˆ¶å¤š Engineã€æ¶æ§‹ã€‚æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¯¦ç¾ï¼Œç”¨æˆ¶å¯ä»¥å‰µå»ºã€ç®¡ç†å’Œä½¿ç”¨å¤šå€‹ç¨ç«‹çš„ RAG Engineã€‚

## ğŸ“Š æœ€çµ‚æ¸¬è©¦çµæœ

### ç¶œåˆæ¸¬è©¦æ‘˜è¦ï¼ˆ2025-07-02ï¼‰
- **ç¸½æ¸¬è©¦é …ç›®**ï¼š15
- **æˆåŠŸç‡**ï¼š80%
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š100% å¯ç”¨
- **ä¸»è¦å•é¡Œ**ï¼šGoogle Cloud API ç•°æ­¥å»¶é²

### åŠŸèƒ½é©—è­‰ç‹€æ…‹
| åŠŸèƒ½æ¨¡å¡Š | ç‹€æ…‹ | å‚™è¨» |
|---------|------|------|
| ç”¨æˆ¶èªè­‰ | âœ… å®Œå…¨æ­£å¸¸ | JWT èªè­‰ç©©å®š |
| Engine å‰µå»º | âœ… æ­£å¸¸ | æœ‰é…é¡é™åˆ¶ |
| Engine åˆ—è¡¨ | âš ï¸ å»¶é²å•é¡Œ | 30-60ç§’åŒæ­¥å»¶é² |
| æ–‡ä»¶ä¸Šå‚³ | âœ… æ­£å¸¸ | æ”¯æ´å¤šæ ¼å¼ |
| æ–‡æª”æŸ¥è©¢ | âœ… æ­£å¸¸ | AI å›ç­”æº–ç¢º |
| å¤š Engine éš”é›¢ | âœ… å®Œå…¨éš”é›¢ | æ•¸æ“šå®‰å…¨ |

## ğŸ—ï¸ æ¶æ§‹æ”¹é€²ç¸½çµ

### 1. å¤š Engine æ”¯æ´æ¶æ§‹
```
èˆŠæ¶æ§‹: ä¸€ç”¨æˆ¶ â†’ ä¸€ RAG Engine
æ–°æ¶æ§‹: ä¸€ç”¨æˆ¶ â†’ å¤šå€‹å‘½å RAG Engine
```

### 2. Engine å‘½åè¦ç¯„
```javascript
// é»˜èª Engine
displayName: "${userId} Knowledge Base"

// è‡ªå®šç¾© Engine  
displayName: "${userId} - ${engineName}"
```

### 3. API ç«¯é»æ“´å±•
```
POST /api/rag/users/engines        # å‰µå»ºæ–° Engine
GET  /api/rag/users/engines        # åˆ—å‡ºç”¨æˆ¶ Engine
POST /api/rag/users/upload         # ä¸Šå‚³åˆ°æŒ‡å®š Engine
POST /api/rag/users/query          # æŸ¥è©¢æŒ‡å®š Engine
GET  /api/rag/users/documents      # ç²å– Engine æ–‡æª”
```

## ğŸ”§ æ ¸å¿ƒæ”¹é€²å…§å®¹

### 1. MultiUserRAGSystem é¡å¢å¼·
- âœ… `createUserRAGEngine(userId, engineName, description)` - æ”¯æ´è‡ªå®šç¾©åç¨±
- âœ… `extractUserIdFromEngine(corpus)` - å¤šæ ¼å¼ç”¨æˆ¶ ID è­˜åˆ¥
- âœ… `waitForOperation(operationName)` - ç•°æ­¥æ“ä½œç­‰å¾…
- âœ… `rateLimitedCall(apiCall)` - API é€Ÿç‡é™åˆ¶

### 2. è·¯ç”±ç³»çµ±é‡æ§‹
- âœ… Engine ç®¡ç†è·¯ç”±ç¾¤çµ„
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†
- âœ… åƒæ•¸é©—è­‰å’Œæ¸…ç†
- âœ… ç”¨æˆ¶æˆæ¬Šæª¢æŸ¥

### 3. ç”¨æˆ¶é«”é©—æ”¹é€²
- âœ… å‹å¥½çš„éŒ¯èª¤ä¿¡æ¯
- âœ… è©³ç´°çš„æ“ä½œåé¥‹
- âœ… Engine ç‹€æ…‹é¡¯ç¤º
- âœ… æ–‡æª”è¨ˆæ•¸çµ±è¨ˆ

## âš ï¸ å·²çŸ¥é™åˆ¶èˆ‡è§£æ±ºæ–¹æ¡ˆ

### 1. Google Cloud API ç•°æ­¥å»¶é²
**å•é¡Œ**ï¼šEngine å‰µå»ºå¾Œ 30-60 ç§’æ‰åœ¨åˆ—è¡¨ä¸­å¯è¦‹
**åŸå› **ï¼šGoogle Cloud Vertex AI å¾Œç«¯è™•ç†å»¶é²
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å·²å¯¦ç¾ `waitForOperation` ç­‰å¾…æ©Ÿåˆ¶
- å»ºè­°ç”¨æˆ¶å‰µå»ºå¾Œç­‰å¾… 1-2 åˆ†é˜
- å‰ç«¯å¯å¢åŠ é€²åº¦æç¤º

### 2. API é…é¡é™åˆ¶  
**å•é¡Œ**ï¼šçŸ­æ™‚é–“å…§é »ç¹å‰µå»º Engine å¯èƒ½å¤±æ•—
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å·²å¯¦ç¾ 2 ç§’é–“éš”é€Ÿç‡é™åˆ¶
- æ·»åŠ éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶
- ç”¨æˆ¶æŒ‡å¼•åˆ†æ•£å‰µå»ºæ™‚é–“

### 3. Engine ç‹€æ…‹åŒæ­¥
**å•é¡Œ**ï¼šæ–° Engine å¯èƒ½é¡¯ç¤º "unknown" ç‹€æ…‹
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç‹€æ…‹æœƒåœ¨æ–‡æª”ä¸Šå‚³å¾Œè‡ªå‹•æ›´æ–°
- ä¸å½±éŸ¿å¯¦éš›åŠŸèƒ½ä½¿ç”¨
- å¯å¢åŠ æ‰‹å‹•åˆ·æ–°æ©Ÿåˆ¶

## ğŸ§ª æ¸¬è©¦æ–‡ä»¶èªªæ˜

### ä¿ç•™çš„æ¸¬è©¦æ–‡ä»¶
- `motion-expert-test.js` - åŸºç¤åŠŸèƒ½æ¸¬è©¦
- `advanced-rag-test.js` - é€²éšæ–‡æª”ç®¡ç†æ¸¬è©¦  
- `multi-engine-test.js` - å¤š Engine æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
- `comprehensive-multi-engine-test.js` - ç¶œåˆç³»çµ±æ¸¬è©¦
- `check-engines.js` - Engine ç‹€æ…‹ç›£æ§

### æ¸¬è©¦åŸ·è¡Œå»ºè­°
```bash
# åŸºç¤åŠŸèƒ½é©—è­‰
node motion-expert-test.js

# å¤š Engine åŠŸèƒ½æ¸¬è©¦  
node multi-engine-test.js

# å®Œæ•´ç³»çµ±æ¸¬è©¦
node comprehensive-multi-engine-test.js

# ç³»çµ±ç‹€æ…‹æª¢æŸ¥
node check-engines.js
```

## ğŸš€ ç”Ÿç”¢éƒ¨ç½²å»ºè­°

### 1. ç’°å¢ƒé…ç½®
- âœ… Google Cloud èªè­‰å·²é…ç½®
- âœ… JWT å¯†é‘°å·²è¨­ç½®
- âœ… æ•¸æ“šåº«é€£æ¥ç©©å®š
- âš ï¸ å»ºè­°ç›£æ§ API é…é¡ä½¿ç”¨

### 2. ç”¨æˆ¶æŒ‡å¼•
```markdown
1. è¨»å†Š/ç™»å…¥ç²å– token
2. å‰µå»ºå‘½å Engineï¼ˆç­‰å¾… 1-2 åˆ†é˜åŒæ­¥ï¼‰
3. ä¸Šå‚³æ–‡æª”åˆ°æŒ‡å®š Engine
4. æŸ¥è©¢æ™‚æŒ‡å®š Engine åç¨±
5. ç®¡ç†å¤šå€‹å°ˆé¡Œ Engine
```

### 3. ç›£æ§è¦é»
- Google Cloud API é…é¡ä½¿ç”¨ç‡
- Engine å‰µå»ºæˆåŠŸç‡
- ç•°æ­¥æ“ä½œå®Œæˆæ™‚é–“
- ç”¨æˆ¶å¤š Engine ä½¿ç”¨æ¨¡å¼

## ğŸ“ˆ ä½¿ç”¨ç¯„ä¾‹

### å‰µå»ºå¤šå€‹ Engine
```bash
# Engine 1: æŠ€è¡“æ–‡æª”
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"engineName":"æŠ€è¡“æ–‡æª”","description":"æŠ€è¡“è³‡æ–™åº«"}' \
  http://localhost:3000/api/rag/users/engines

# Engine 2: æ¥­å‹™è³‡æ–™  
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"engineName":"æ¥­å‹™è³‡æ–™","description":"æ¥­å‹™çŸ¥è­˜åº«"}' \
  http://localhost:3000/api/rag/users/engines
```

### åˆ†åˆ¥ç®¡ç†æ–‡æª”
```bash
# ä¸Šå‚³æŠ€è¡“æ–‡æª”
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@tech-guide.pdf" \
  -F "engineName=æŠ€è¡“æ–‡æª”" \
  http://localhost:3000/api/rag/users/upload

# æŸ¥è©¢æŠ€è¡“å…§å®¹
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"query":"æŠ€è¡“æ¶æ§‹æ˜¯ä»€éº¼ï¼Ÿ","engineName":"æŠ€è¡“æ–‡æª”"}' \
  http://localhost:3000/api/rag/users/query
```

## ğŸ”® å¾ŒçºŒå„ªåŒ–æ–¹å‘

### çŸ­æœŸï¼ˆ1-2 é€±ï¼‰
1. **å‰ç«¯é›†æˆ**ï¼šEngine ç®¡ç†ç•Œé¢
2. **ç‹€æ…‹åŒæ­¥**ï¼šè‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶
3. **æ‰¹é‡æ“ä½œ**ï¼šå¤šæ–‡ä»¶ä¸Šå‚³
4. **ä½¿ç”¨çµ±è¨ˆ**ï¼šEngine ä½¿ç”¨åˆ†æ

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰
1. **è·¨ Engine æŸ¥è©¢**ï¼šåŒæ™‚æœç´¢å¤šå€‹ Engine
2. **Engine æ¨¡æ¿**ï¼šé è¨­é…ç½®æ¨¡æ¿
3. **æ¬Šé™ç®¡ç†**ï¼šEngine å…±äº«æ©Ÿåˆ¶
4. **æ€§èƒ½å„ªåŒ–**ï¼šæŸ¥è©¢é€Ÿåº¦æå‡

### é•·æœŸï¼ˆ3-6 æœˆï¼‰
1. **ä¼æ¥­åŠŸèƒ½**ï¼šåœ˜éšŠå”ä½œ
2. **é«˜ç´šåˆ†æ**ï¼šä½¿ç”¨æ´å¯Ÿ
3. **è‡ªå‹•åŒ–**ï¼šæ™ºèƒ½åˆ†é¡
4. **æ“´å±•æ€§**ï¼šåˆ†ä½ˆå¼æ¶æ§‹

## ğŸ‰ é …ç›®æˆå°±

### æŠ€è¡“æˆå°±
- âœ… å®Œå…¨é‡æ§‹ç‚ºå¤š Engine æ¶æ§‹
- âœ… ä¿æŒå‘å¾Œå…¼å®¹æ€§
- âœ… å¯¦ç¾ç”¨æˆ¶æ•¸æ“šå®Œå…¨éš”é›¢
- âœ… å»ºç«‹å¥å…¨çš„æ¸¬è©¦é«”ç³»

### åŠŸèƒ½æˆå°±  
- âœ… æ”¯æ´ç„¡é™åˆ¶ Engine å‰µå»º
- âœ… éˆæ´»çš„ Engine å‘½åå’Œæè¿°
- âœ… ç²¾ç¢ºçš„æ–‡æª”æŸ¥è©¢å®šä½
- âœ… å®Œæ•´çš„ Engine ç”Ÿå‘½é€±æœŸç®¡ç†

### ç”¨æˆ¶é«”é©—æˆå°±
- âœ… ç›´è§€çš„ API è¨­è¨ˆ
- âœ… æ¸…æ™°çš„éŒ¯èª¤ä¿¡æ¯
- âœ… å®Œæ•´çš„æ“ä½œåé¥‹
- âœ… å½ˆæ€§çš„ä½¿ç”¨æ–¹å¼

---

## ğŸ“‹ æœ€çµ‚æª¢æŸ¥æ¸…å–®

- [x] å¤š Engine å‰µå»ºåŠŸèƒ½
- [x] Engine åˆ—è¡¨ç®¡ç†
- [x] åˆ†åˆ¥æ–‡æª”ä¸Šå‚³  
- [x] æŒ‡å®š Engine æŸ¥è©¢
- [x] æ–‡æª”åˆ—è¡¨ç²å–
- [x] ç”¨æˆ¶æ•¸æ“šéš”é›¢
- [x] éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [x] API é€Ÿç‡é™åˆ¶
- [x] ç•°æ­¥æ“ä½œç­‰å¾…
- [x] æ¸¬è©¦æ–‡ä»¶å®Œæ•´
- [x] æ–‡æª”èªªæ˜è©³ç´°

**é …ç›®ç‹€æ…‹ï¼šğŸ¯ å¤š Engine æ¶æ§‹å‡ç´šå®Œæˆï¼**

**æœ€å¾Œæ›´æ–°ï¼š2025å¹´7æœˆ2æ—¥**  
**ç‰ˆæœ¬ï¼šv2.0 - Multi-Engine Support**

---

âœ¨ **MotionExpert Backend ç¾å·²æ”¯æ´å¼·å¤§çš„å¤š Engine RAG æ¶æ§‹ï¼Œç‚ºç”¨æˆ¶æä¾›éˆæ´»çš„çŸ¥è­˜ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼**
